---
title: "P8106 Midterm Project"
author: "Leyang Rui, Jinghan Zhao"
date: "2025-03-28"
output:
  pdf_document: default
  html_document: default
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(fig.width = 10, 
                      fig.height = 5,
                      out.width = "90%",
                      message = FALSE,
                      warning = FALSE)
set.seed(37)

library(tidyverse)
library(forcats)
library(corrplot)
```

## Load Data

```{r load_data}
load("data/dat1.RData")
train_data = dat1 |>
  janitor::clean_names() |>
  mutate(
    gender = as.factor(gender),
    diabetes = as.factor(diabetes),
    hypertension = as.factor(hypertension),
    race = fct_recode(race,
                  White = "1",
                  Asian = "2",
                  Black = "3",
                  Hispanic = "4"),
    gender = fct_recode(gender,
                        Male = "1",
                        Female = "0"),
    smoking = fct_recode(smoking,
                         "Never smoked" = "0",
                         "Former smoker" = "1",
                         "Current smoker" = "2"))

load("data/dat2.RData")
test_data = dat2 |>
  janitor::clean_names() |>
  mutate(
    gender = as.factor(gender),
    diabetes = as.factor(diabetes),
    hypertension = as.factor(hypertension),
    race = fct_recode(race,
                  White = "1",
                  Asian = "2",
                  Black = "3",
                  Hispanic = "4"),
    gender = fct_recode(gender,
                        Male = "1",
                        Female = "0"),
    smoking = fct_recode(smoking,
                         "Never smoked" = "0",
                         "Former smoker" = "1",
                         "Current smoker" = "2")
  )

```

### Modify Data

```{r}
train_data1 = 
  train_data %>% 
  select(-id, -height, -weight, -hypertension)

x_train = model.matrix(log_antibody ~ ., train_data1)[, -1]
y_train = train_data1[, "log_antibody"]
```


## Descriptive Analysis

### Numeric Variables

```{r}
train_data |> 
  pivot_longer(
    cols = c(age, height, weight, bmi),
    names_to = "variable",
    values_to = "value"
  ) |>
  ggplot(aes(x = value, y = log_antibody, color = variable)) +
  geom_point(alpha = 0.5, size = 0.6) +
  facet_wrap(variable ~ .,  scales = "free") +
    labs(title = "Distribution of the Demographic Continuous Variables",
         x = "Variables",
         y = "Log_Antibody")

train_data |> 
  pivot_longer(
    cols = c(sbp, ldl, time),
    names_to = "variable",
    values_to = "value"
  ) |>
  ggplot(aes(x = value, y = log_antibody, color = variable)) +
  geom_point(alpha = 0.5, size = 0.6) +
  facet_wrap(variable ~ .,  scales = "free") +
    labs(title = "Distribution of the Clinical Continuous Variables",
         x = "Variables",
         y = "Log_Antibody")
```

```{r}
train_data %>% 
  pivot_longer(
    cols = c(age, height, weight, bmi, sbp, ldl, time, log_antibody),
    names_to = "variable_name",
    values_to = "value"
  ) %>% 
  group_by(variable_name) %>% 
  summarize(
    mean = mean(value),
    median = median(value),
    min = min(value),
    first_quantile = quantile(value, probs = 0.25),
    third_quantile = quantile(value, probs = 0.75),
    max = max(value)
  ) %>% 
  ungroup() %>% 
  arrange(desc(variable_name == "log_antibody"), variable_name) %>% 
  knitr::kable(digits = 3, caption = "Descriptive Statistics")
```


### Categorical Variables

```{r}
train_data |> 
  pivot_longer(
    cols = c(gender, race, smoking, diabetes, hypertension),
    names_to = "variable",
    values_to = "value"
  ) |>
  mutate(
    variable = factor(variable, levels = c("gender", "race", "smoking", "diabetes", "hypertension"))
  ) |>
  ggplot(aes(x = value, y = log_antibody, fill = variable)) +
  geom_boxplot(alpha = 0.5) +
  facet_wrap(variable ~ .,  scales = "free") +
    labs(title = "Distribution of the Categorical Variables",
         x = "Variables",
         y = "Log_Antibody") +
  theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust = 1))
```


### Correlation Plot

```{r}
corrplot(cor(x_train), method = "circle", type = "full")
```



## Regression


### Elastic Net

### PCR and PLS

### GAM and MARS

### Regression Trees
